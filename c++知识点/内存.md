#### 1. 简述一下堆和栈的区别

**参考回答**

区别：

1. **堆栈空间分配不同**。栈由操作系统自动分配释放 ，存放**函数的参数值，局部变量的值**等；堆一般**由程序员分配释放**。
2. **堆栈缓存方式不同**。栈使用的是**一级缓存**， 它们通常都是被调用时处于存储空间中，调用完毕立即释放；堆则是存放在**二级缓存**中，速度要慢些。
3. **堆栈数据结构不同**。堆类似**数组结构**；栈类似**栈结构**，先进后出。

#### 2. 简述C++的内存管理

1. **内存分配方式**：

   在C++中，内存分成5个区，他们分别是堆、栈、自由存储区、全局/静态存储区和常量存储区。

   **栈**，在执行函数时，函数内局部变量的存储单元都可以在栈上创建，函数执行结束时这些存储单元自动被释放。

   **堆**，就是那些由new分配的内存块，一般一个new就要对应一个delete。

   **自由存储区**，就是那些由malloc等分配的内存块，和堆是十分相似的，不过是用free来结束自己的生命。

   **全局/静态存储区**，全局变量和静态变量被分配到同一块内存中

   **常量存储区**，这是一块比较特殊的存储区，里面存放的是常量，不允许修改。

   #### 3.**内存泄露及解决办法**：

   **什么是内存泄露？**

   简单地说就是申请了一块内存空间，使用完毕后没有释放掉。（1）new和malloc申请资源使用后，没有用delete和free释放；（2）子类继承父类时，父类析构函数不是虚函数。（3）Windows句柄资源使用后没有释放。

   **怎么检测？**

   第一：良好的编码习惯，使用了内存分配的函数，一旦使用完毕,要记得使用其相应的函数释放掉。

   第二：将分配的内存的指针以链表的形式自行管理，使用完毕之后从链表中删除，程序结束时可检查改链表。

   第三：使用智能指针。

   第四：**一些常见的工具插件，如ccmalloc、Dmalloc、Leaky、Valgrind等等**。

#### 4.程序有哪些section，分别的作用？程序启动的过程？怎么判断数据分配在栈上还是堆上？

![](.\pics\memory.png)

**一个程序有哪些section：**

如上图，**从低地址到高地址，一个程序由代码段、数据段、** **BSS** **段组成。**

1. **数据段：**存放程序中已初始化的全局变量和静态变量的一块内存区域。

2. **代码段：**存放程序执行代码的一块内存区域。只读，代码段的头部还会包含一些只读的常数变量。

3. **BSS** 段：存放程序中未初始化的全局变量和静态变量的一块内存区域。

4. 可执行程序在运行时又会多出两个区域：堆区和栈区。

   **堆区：**动态申请内存用。堆从低地址向高地址增长。

   **栈区：**存储局部变量、函数参数值。栈从高地址向低地址增长。是一块连续的空间。

5. 最后还有一个**文件映射区**，位于堆和栈之间。

**程序启动的过程：**

1. 操作系统**首先创建相应的进程并分配私有的进程空间**，然后操作系统的加载器负责把**可执行文件的数据段和代码段映射到进程的虚拟内存空间中。**
2. 加载器读入可执行程序的导入符号表，根据这些符号表可以查找出该可执行程序的所有依赖的动态链接库。
3. 加载器针**对该程序的每一个动态链接库调用LoadLibrary**
   （1）查找对应的动态库文件，加载器为该动态链接库确定一个合适的基地址。
   （2）加载器读取该动态链接库的导入符号表和导出符号表，比较应用程序要求的导入符号是否匹配该库的导出符号。
   （3）针对该库的导入符号表，查找对应的依赖的动态链接库，如有跳转，则跳到3
   （4）调用该动态链接库的初始化函数
4. 初始化应用程序的全局变量，对于全局对象自动调用构造函数。
5. 进入应用程序入口点函数开始执行。

